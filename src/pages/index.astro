---
export const prerender = false
import Layout from '../layouts/Layout.astro';
import axios, { type AxiosResponse } from "axios";
import { aResult, type Result } from "@volpe/utils";
import {type Category, type Course, type IAcademy} from "../env.d"
import Card from "../components/Card/Card.tsx";
import Market from "../components/Market/Market.astro"

const currentTime = new Date().toLocaleTimeString();
Astro.response.headers.set('Cache-Control', 'public, maxage=20, s-maxage=30, stale-while-revalidate=15');

const api_qa = axios.create({
  baseURL: "https://qa.api.somosedison.com",
  headers: {
    Authorization: "l33hDPtjJK0emSag5NcJKdrJbWXUFpORTSih",
  },
});

const [err, axiosResponse] = await api_qa.get[aResult](`/courses/market/2a748937-dfff-419c-908e-fa16856e19fe`) as Result<AxiosResponse<Course[]>>;
// const [err, axiosResponse] = await api_qa.get[aResult](`/courses/market/ffde42cb-1588-4928-8dd6-330b02ff26df`) as Result<AxiosResponse<Course[]>>;

if (err) throw err
if (!axiosResponse) throw err

const [academyError, axiosResponseAcademy] = await api_qa.get[aResult](`/academies/2a748937-dfff-419c-908e-fa16856e19fe`) as Result<AxiosResponse<IAcademy>>;

if (academyError) throw academyError
if (!axiosResponseAcademy) throw axiosResponseAcademy



const {data: courses} = axiosResponse
const {data: academy} = axiosResponseAcademy

const [categoriesError, axiosResponseCategories] = await api_qa.get[aResult](`/categories`) as Result<AxiosResponse<Category[]>>;

if (categoriesError) throw categoriesError
if (!axiosResponseCategories) throw axiosResponseCategories

const {data: allCategories} = axiosResponseCategories

let categories = allCategories?.filter((e: any) => e.academyId === academy?.id)
---

<Layout academy={academy}>
  hola<br/>
  {currentTime}
  <br/>
  <h1 class="h-[100px]">Im√°genes Optimizadas</h1>
  <Market courses={courses}/>
</Layout>

